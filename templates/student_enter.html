<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;600;800&display=swap');
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Cairo",sans-serif;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background: #ffffff;
      color:#333;
      padding-bottom:100px;
    }
    .card{
      width:95%;max-width:450px;
      background: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius:16px;
      padding:30px;
      box-shadow:0 10px 30px rgba(0,0,0,0.1);
    }
    h1{ margin:0 0 8px 0; font-size:24px; color:#333; font-weight:bold; text-align:center }
    p.lead{ margin:0 0 18px 0; color:#666; text-align:center }

    form { display:flex; flex-direction:column; gap:14px; align-items:center; }
    
    input, select {
      width: 100%;
      padding:14px;
      border-radius:10px;
      border:2px solid #e0e0e0;
      background: #f8f9fa;
      font-size:18px;
      outline:none;
      color: #333;
      text-align: right;
      line-height: 1.5;
      box-sizing: border-box;
      transition: border-color 0.3s ease, background-color 0.3s ease;
    }
    input:focus, select:focus {
      border-color: #667eea;
      background: #ffffff;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    input::placeholder, select {
      color: #666;
      text-align: right;
    }
    select option {
      text-align: right;
    }

    .big-btn {
      margin-top:0;
      width:100%;
      padding:14px;
      border-radius:12px;
      font-size:18px;
      font-weight:700;
      border:none;
      cursor:pointer;
      background: linear-gradient(135deg,#764ba2,#667eea);
      color:#fff;
      box-shadow:0 4px 15px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
      line-height: 1.5;
      box-sizing: border-box;
    }
    .big-btn:hover {
      transform: translateY(-2px);
      box-shadow:0 6px 20px rgba(0,0,0,0.3);
    }
    .big-btn:active{ transform: translateY(0) }

    .small-note{ font-size:13px; color:rgba(255,255,255,0.8); margin-top:8px }
    @media (max-width:420px){ 
      .card{ padding:20px; max-width:90% } 
      .big-btn{ font-size:16px; padding:12px }
    }

    .cognia-badges {
        position: fixed;
        top: 10px;
        left: 10px;
        z-index: 10000;
        display: flex;
        gap: 8px;
        align-items: flex-start;
    }

    .cognia-badges img {
        height: 70px;
        width: auto;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        transition: transform 0.3s ease;
    }

    .cognia-badges img:hover {
        transform: scale(1.05);
    }

    .waiting-message {
      background: linear-gradient(135deg, #ffd700, #ffb347);
      color: #333;
      border: 3px solid #ffa500;
      padding: 30px 20px;
      border-radius: 16px;
      text-align: center;
      font-weight: bold;
      font-size: 20px;
      margin-bottom: 20px;
      box-shadow: 0 8px 25px rgba(255, 165, 0, 0.3);
      animation: pulse 2s ease-in-out infinite;
    }

    .waiting-message .icon {
      font-size: 48px;
      margin-bottom: 15px;
      display: block;
    }

    .waiting-message .text {
      line-height: 1.8;
      margin-bottom: 10px;
    }

    .waiting-message .sub-text {
      font-size: 16px;
      color: #555;
      margin-top: 10px;
      font-weight: normal;
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 8px 25px rgba(255, 165, 0, 0.3);
      }
      50% {
        transform: scale(1.02);
        box-shadow: 0 12px 35px rgba(255, 165, 0, 0.5);
      }
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="cognia-badges">
    <img src="{{ url_for('static', filename='1.png') }}" alt="Cognia System of Distinction">
    <img src="{{ url_for('static', filename='Cognia.png') }}" alt="Cognia Accredited">
  </div>
  <div class="card">
    {% if student_status == 'pending' %}
      <div class="waiting-message" id="waitingMessage">
        <span class="icon">â³</span>
        <div class="text">Ø¬Ø§Ø±Ù‰ Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨Ùƒ...</div>
        <div class="sub-text">Ø±Ø¬Ø§Ø¡Ø§ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</div>
      </div>
    {% else %}
      <img src="{{ url_for('static', filename='logo.png') }}" alt="Ø§Ù„Ø´Ø¹Ø§Ø±" style="display:block; margin:0 auto 20px auto; height:160px; width:auto">
      <h1>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</h1>
      <p class="lead">Ø§Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© Ù„Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</p>

      {% with msgs = get_flashed_messages() %}
        {% if msgs %}
          <div style="background:#ff4444;color:white;border:1px solid #ff6666;padding:10px 14px;border-radius:10px;text-align:right;font-weight:700;margin-bottom:15px;width:100%">
            {{ msgs[-1] }}
          </div>
        {% endif %}
      {% endwith %}

      <form method="post" action="{{ url_for('student_enter') }}" id="loginForm">
        <input type="text" id="full_name" name="full_name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„" required>
        
        <input type="text" id="id_number" name="id_number" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©" required>
        
        <input type="tel" id="phone" name="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„" required>
        
        <select id="grade" name="grade" required>
          <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</option>
          <option value="Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹">Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹</option>
          <option value="Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³">Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³</option>
          <option value="Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³">Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³</option>
          <option value="Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø·">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø·</option>
          <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø·">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø·</option>
          <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø·">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø·</option>
          <option value="Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
          <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
          <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
        </select>

        <select id="section" name="section" required>
          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
          <option value="Ø¹Ø±Ø¨ÙŠ">Ø¹Ø±Ø¨ÙŠ</option>
          <option value="Ø¯ÙˆÙ„ÙŠ">Ø¯ÙˆÙ„ÙŠ</option>
        </select>

        <button class="big-btn" type="submit">ğŸ‘¨â€ğŸ“ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
      </form>
    {% endif %}

    
  </div>
  <div style="position:fixed; bottom:10px; left:0; right:0; text-align:center; font-weight:bold; font-size:16px; color:#333; padding:10px; background:rgba(255,255,255,0.9); z-index:9999">
    ØªØµÙ…ÙŠÙ… Ù‚Ø³Ù… Ø§Ù„Ø­Ø§Ø³Ø¨ Ø§Ù„Ø¢Ù„Ù‰ Ø¨Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø£Ù†Ø¬Ø§Ù„ Ø§Ù„Ø£Ù‡Ù„ÙŠØ©Â©
  </div>

  {% if student_status == 'pending' %}
  <script>
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙƒÙ„ 3 Ø«ÙˆØ§Ù†
    let checkInterval = setInterval(function() {
      fetch('{{ url_for("check_student_status") }}')
        .then(response => response.json())
        .then(data => {
          if (data.approved) {
            // ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø·Ø§Ù„Ø¨ - Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            clearInterval(checkInterval);
            window.location.href = '{{ url_for("student_start_exam") }}';
          } else if (data.status === 'no_session' || data.status === 'not_found') {
            // Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ø£Ùˆ Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ - Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            clearInterval(checkInterval);
            window.location.reload();
          }
          // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ø§ ØªØ²Ø§Ù„ pendingØŒ Ø³Ù†Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚
        })
        .catch(error => {
          console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø©:', error);
          // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ØŒ Ù†Ø¹ÙŠØ¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ ÙØªØ±Ø© Ø£Ø·ÙˆÙ„
          setTimeout(function() {
            window.location.reload();
          }, 10000);
        });
    }, 3000); // ÙƒÙ„ 3 Ø«ÙˆØ§Ù†

    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø¤Ù‚Øª Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('beforeunload', function() {
      clearInterval(checkInterval);
    });
  </script>
  {% endif %}
</body>
</html>
